{"version":3,"file":"index.js","sources":["pages/index/index.vue","pages/index/index.vue?type=page"],"sourcesContent":["<template>\r\n  <view class=\"container\">\r\n    <!-- 练习类型选择 -->\r\n    <view class=\"type-selector\">\r\n      <button\r\n        v-for=\"type in practiceTypes\"\r\n        :key=\"type\"\r\n        :class=\"['type-btn', { active: currentType === type }]\"\r\n        @click=\"selectType(type)\"\r\n      >\r\n        {{ type.toUpperCase() }}\r\n      </button>\r\n    </view>\r\n\r\n    <!-- 问题展示 -->\r\n    <view class=\"question-container\" v-if=\"currentQuestion\">\r\n      <text class=\"question-text\">{{ currentQuestion }}</text>\r\n      <text class=\"progress-text\"\r\n        >Question {{ currentIndex + 1 }} of {{ questions.length }}</text\r\n      >\r\n    </view>\r\n\r\n    <!-- 录音控制 -->\r\n    <view class=\"recorder-control\">\r\n      <button\r\n        class=\"record-btn\"\r\n        :class=\"{ recording: isRecording }\"\r\n        @click=\"handleRecord\"\r\n      >\r\n        {{ isRecording ? `Recording... ${recordingTime}s` : \"Start Recording\" }}\r\n      </button>\r\n    </view>\r\n\r\n    <!-- 评价结果 -->\r\n    <view class=\"evaluation-result\" v-if=\"evaluation\">\r\n      <text class=\"score\">Score: {{ evaluation.score }}</text>\r\n      <text class=\"feedback\">Feedback: {{ evaluation.feedback }}</text>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed, watch, onMounted } from \"vue\";\r\nimport { useStore } from \"vuex\";\r\nimport recorder from \"../../utils/recorder.js\";\r\nimport api from \"@/api\";\r\nimport dataset from \"@/static/dataset.json\";\r\nimport config from \"@/config\";\r\n\r\nconst store = useStore();\r\n\r\n// 响应式数据\r\nconst recordingTime = ref(0);\r\nconst isRecording = ref(false);\r\nlet timer = null;\r\n\r\n// 从 Vuex 获取状态\r\nconst currentType = computed(() => store.state.currentType);\r\nconst questions = computed(() => store.state.questions);\r\nconst currentIndex = computed(() => store.state.currentIndex);\r\nconst evaluation = computed(() => store.state.evaluation);\r\nconst currentQuestion = computed(() => store.getters.currentQuestion);\r\nconst progress = computed(() => store.getters.progress);\r\nconst isFinished = computed(() => store.getters.isFinished);\r\nconst practiceTypes = computed(() => config.practiceTypes);\r\n\r\n// 初始化\r\nonMounted(() => {\r\n  recorder.init();\r\n  store.dispatch(\"initPractice\", {\r\n    type: \"part1\",\r\n    questions: dataset.part1,\r\n  });\r\n});\r\n\r\n// 方法\r\nconst selectType = async (type) => {\r\n  const data = dataset;\r\n  console.log(data);\r\n  store.dispatch(\"initPractice\", {\r\n    type,\r\n    questions: data[type],\r\n  });\r\n};\r\n\r\nconst handleRecord = async () => {\r\n  if (isRecording.value) {\r\n    isRecording.value = false;\r\n    const { filePath, duration } = await recorder.stop();\r\n\r\n    // 语音转文字\r\n    const text = await api.speechToText(filePath);\r\n\r\n    // 提交回答\r\n    await store.dispatch(\"submitAnswer\", {\r\n      audioPath: filePath,\r\n      text,\r\n    });\r\n\r\n    // 如果是最后一个问题，提交评价\r\n    if (isFinished.value) {\r\n      await store.dispatch(\"submitEvaluation\");\r\n    }\r\n  } else {\r\n    isRecording.value = true;\r\n    await recorder.start();\r\n    recordingTime.value = 0;\r\n    timer = setInterval(() => {\r\n      recordingTime.value = recorder.getCurrentTime();\r\n    }, 1000);\r\n  }\r\n};\r\n</script>\r\n\r\n<style>\r\n.container {\r\n  padding: 20px;\r\n}\r\n\r\n.type-selector {\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.type-btn {\r\n  margin: 5px;\r\n  padding: 10px 20px;\r\n  border-radius: 5px;\r\n}\r\n\r\n.type-btn.active {\r\n  background-color: #007bff;\r\n  color: white;\r\n}\r\n\r\n.question-container {\r\n  margin: 20px 0;\r\n}\r\n\r\n.question-text {\r\n  font-size: 18px;\r\n  font-weight: bold;\r\n}\r\n\r\n.progress-text {\r\n  display: block;\r\n  margin-top: 10px;\r\n  color: #666;\r\n}\r\n\r\n.record-btn {\r\n  width: 100%;\r\n  padding: 15px;\r\n  border-radius: 25px;\r\n  background-color: #007bff;\r\n  color: white;\r\n}\r\n\r\n.record-btn.recording {\r\n  background-color: #dc3545;\r\n}\r\n\r\n.evaluation-result {\r\n  margin-top: 20px;\r\n  padding: 15px;\r\n  background-color: #f8f9fa;\r\n  border-radius: 5px;\r\n}\r\n\r\n.score {\r\n  font-size: 16px;\r\n  font-weight: bold;\r\n  color: #28a745;\r\n}\r\n\r\n.feedback {\r\n  display: block;\r\n  margin-top: 10px;\r\n  color: #666;\r\n}\r\n</style>\r\n","import MiniProgramPage from '/Users/weikeshi/Projects/ielts-speaking/frontend/pages/index/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["useStore","ref","computed","config","onMounted","recorder","uni","api","MiniProgramPage"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiDA,UAAM,QAAQA,cAAQ,SAAA;AAGtB,UAAM,gBAAgBC,cAAAA,IAAI,CAAC;AAC3B,UAAM,cAAcA,cAAAA,IAAI,KAAK;AAI7B,UAAM,cAAcC,cAAAA,SAAS,MAAM,MAAM,MAAM,WAAW;AAC1D,UAAM,YAAYA,cAAAA,SAAS,MAAM,MAAM,MAAM,SAAS;AACtD,UAAM,eAAeA,cAAAA,SAAS,MAAM,MAAM,MAAM,YAAY;AAC5D,UAAM,aAAaA,cAAAA,SAAS,MAAM,MAAM,MAAM,UAAU;AACxD,UAAM,kBAAkBA,cAAAA,SAAS,MAAM,MAAM,QAAQ,eAAe;AACnDA,kBAAAA,SAAS,MAAM,MAAM,QAAQ,QAAQ;AACtD,UAAM,aAAaA,cAAAA,SAAS,MAAM,MAAM,QAAQ,UAAU;AAC1D,UAAM,gBAAgBA,cAAQ,SAAC,MAAMC,OAAM,OAAC,aAAa;AAGzDC,kBAAAA,UAAU,MAAM;AACdC,qBAAQ,SAAC,KAAI;AACb,YAAM,SAAS,gBAAgB;AAAA,QAC7B,MAAM;AAAA,QACN,WAAW,QAAQ;AAAA,MACvB,CAAG;AAAA,IACH,CAAC;AAGD,UAAM,aAAa,OAAO,SAAS;AACjC,YAAM,OAAO;AACbC,oBAAAA,kDAAY,IAAI;AAChB,YAAM,SAAS,gBAAgB;AAAA,QAC7B;AAAA,QACA,WAAW,KAAK,IAAI;AAAA,MACxB,CAAG;AAAA,IACH;AAEA,UAAM,eAAe,YAAY;AAC/B,UAAI,YAAY,OAAO;AACrB,oBAAY,QAAQ;AACpB,cAAM,EAAE,UAAU,SAAQ,IAAK,MAAMD,eAAQ,SAAC,KAAI;AAGlD,cAAM,OAAO,MAAME,UAAAA,IAAI,aAAa,QAAQ;AAG5C,cAAM,MAAM,SAAS,gBAAgB;AAAA,UACnC,WAAW;AAAA,UACX;AAAA,QACN,CAAK;AAGD,YAAI,WAAW,OAAO;AACpB,gBAAM,MAAM,SAAS,kBAAkB;AAAA,QACxC;AAAA,MACL,OAAS;AACL,oBAAY,QAAQ;AACpB,cAAMF,eAAAA,SAAS;AACf,sBAAc,QAAQ;AACd,oBAAY,MAAM;AACxB,wBAAc,QAAQA,wBAAS;QAChC,GAAE,GAAI;AAAA,MACR;AAAA,IACH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC9GA,GAAG,WAAWG,SAAe;"}